#!/usr/bin/env sh

case "$1" in
  "download")
    if ! command -v composer 1> /dev/null 2> /dev/null; then
      wget "https://github.com/composer/composer/releases/download/${COMPOSER_VERSION}/composer.phar" -O /usr/local/bin/composer

      if [ "$COMPOSER_VERIFY_CHECKSUM" = true ] && [ "$COMPOSER_CHECKSUM" != "$(sha3sum /usr/local/bin/composer | awk '{ print $1 }')" ]; then
        >&2 echo "[ERROR] Invalid composer checksum."
        rm -f /usr/local/bin/composer
        exit 1
      fi

      chmod +x /usr/local/bin/composer
      ln /usr/local/bin/composer /usr/local/bin/composer.phar
    fi
  ;;

  "remove")
    rm -f /usr/local/bin/composer /usr/local/bin/composer.phar
  ;;

  *)
    >&2 echo "Unknown command [${1}]"
    exit 2
  ;;
esac